const AbstractHandler = require('./AbstractHandler');
const Constants = require('../../../../util/Constants');

class ResumedHandler extends AbstractHandler {
<<<<<<< HEAD
  handle() {
    const client = this.packetManager.client;
    const ws = client.ws.connection;

=======
  handle(packet) {
    const client = this.packetManager.client;
    const ws = client.ws.connection;

    ws._trace = packet.d._trace;

>>>>>>> 7667619318f2e7e4ad64e58abdc3812448859fd9
    ws.status = Constants.Status.READY;
    this.packetManager.handleQueue();

    const replayed = ws.sequence - ws.closeSequence;

<<<<<<< HEAD
    ws.debug(`RESUMED | replayed ${replayed} events.`);
=======
    ws.debug(`RESUMED ${ws._trace.join(' -> ')} | replayed ${replayed} events.`);
>>>>>>> 7667619318f2e7e4ad64e58abdc3812448859fd9
    client.emit(Constants.Events.RESUME, replayed);
    ws.heartbeat();
  }
}

/**
 * Emitted whenever a WebSocket resumes.
 * @event Client#resume
 * @param {number} replayed The number of events that were replayed
 */

module.exports = ResumedHandler;
