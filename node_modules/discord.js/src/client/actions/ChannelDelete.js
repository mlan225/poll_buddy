const Action = require('./Action');
<<<<<<< HEAD
const DMChannel = require('../../structures/DMChannel');
=======
>>>>>>> 7667619318f2e7e4ad64e58abdc3812448859fd9

class ChannelDeleteAction extends Action {
  constructor(client) {
    super(client);
    this.deleted = new Map();
  }

  handle(data) {
    const client = this.client;

    let channel = client.channels.get(data.id);
    if (channel) {
      client.dataManager.killChannel(channel);
      this.deleted.set(channel.id, channel);
      this.scheduleForDeletion(channel.id);
    } else {
      channel = this.deleted.get(data.id) || null;
    }
<<<<<<< HEAD
    if (channel) {
      if (channel.messages && !(channel instanceof DMChannel)) {
        for (const message of channel.messages.values()) {
          message.deleted = true;
        }
      }
      channel.deleted = true;
    }
=======
    if (channel) channel.deleted = true;
>>>>>>> 7667619318f2e7e4ad64e58abdc3812448859fd9

    return { channel };
  }

  scheduleForDeletion(id) {
    this.client.setTimeout(() => this.deleted.delete(id), this.client.options.restWsBridgeTimeout);
  }
}

module.exports = ChannelDeleteAction;
